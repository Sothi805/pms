{% extends "base.html" %}
{% block title %}{{ task.title }} — PMS{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="mb-8">
        <a href="{% url 'general_tasks:task_list' %}" class="text-white/40 hover:text-white text-sm mb-4 inline-block">← Back to tasks</a>
        <h1 class="text-3xl font-semibold text-white">{{ task.title }}</h1>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Task details card -->
            <div class="glass rounded-2xl p-8">
                <div class="mb-6">
                    <h2 class="text-sm font-semibold text-white/60 mb-4">STATUS & PRIORITY</h2>
                    <div class="flex gap-4">
                        <div>
                            <p class="text-xs text-white/40 mb-1">Status</p>
                            <div class="flex gap-2">
                                {% for status_key, status_label in task.STATUS_CHOICES %}
                                <a href="{% url 'general_tasks:task_update_status' task.pk status_key %}"
                                   class="px-3 py-1.5 text-xs font-medium rounded-lg transition-all
                                    {% if task.status == status_key %}
                                        {% if status_key == 'done' %}bg-green-500/30 text-green-300{% elif status_key == 'in_progress' %}bg-blue-500/30 text-blue-300{% else %}bg-gray-500/30 text-gray-300{% endif %}
                                    {% else %}
                                        bg-white/5 text-white/60 hover:bg-white/10
                                    {% endif %}">
                                    {{ status_label }}
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        <div>
                            <p class="text-xs text-white/40 mb-1">Priority</p>
                            <span class="inline-block px-3 py-1 text-xs font-medium rounded-lg
                                {% if task.priority == 'critical' %}bg-red-500/20 text-red-300
                                {% elif task.priority == 'high' %}bg-orange-500/20 text-orange-300
                                {% elif task.priority == 'medium' %}bg-yellow-500/20 text-yellow-300
                                {% else %}bg-green-500/20 text-green-300{% endif %}">
                                {{ task.get_priority_display }}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="border-t border-white/10 pt-6">
                    <h3 class="text-sm font-semibold text-white/60 mb-4">DESCRIPTION</h3>
                    {% if task.description %}
                    <p class="text-white/80 leading-relaxed">{{ task.description }}</p>
                    {% else %}
                    <p class="text-white/40 italic">No description provided.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Edit/Delete actions -->
            {% if user.is_system_admin or user == task.created_by %}
            <div class="flex gap-3">
                <a href="{% url 'general_tasks:task_edit' task.pk %}"
                   class="px-4 py-2.5 bg-blue-500/80 hover:bg-blue-500 text-white text-sm font-medium rounded-xl transition-all">
                    Edit Task
                </a>
                <a href="{% url 'general_tasks:task_delete' task.pk %}"
                   class="px-4 py-2.5 bg-red-500/10 hover:bg-red-500/20 text-red-300 text-sm font-medium rounded-xl transition-all">
                    Delete Task
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="space-y-4">
            <!-- Info card -->
            <div class="glass rounded-2xl p-6">
                <h3 class="text-sm font-semibold text-white/60 mb-4">DETAILS</h3>
                <div class="space-y-4 text-sm">
                    {% if task.assigned_to %}
                    <div>
                        <p class="text-white/40 mb-1">Assigned to</p>
                        <p class="text-white">{{ task.assigned_to.username }}</p>
                    </div>
                    {% endif %}
                    
                    {% if task.due_date %}
                    <div>
                        <p class="text-white/40 mb-1">Due date</p>
                        <p class="text-white">{{ task.due_date|date:"F d, Y" }}</p>
                    </div>
                    {% endif %}
                    
                    <div>
                        <p class="text-white/40 mb-1">Created by</p>
                        <p class="text-white">{{ task.created_by.username }}</p>
                    </div>
                    
                    <div>
                        <p class="text-white/40 mb-1">Created</p>
                        <p class="text-white">{{ task.created_at|date:"F d, Y • H:i" }}</p>
                    </div>
                    
                    <div>
                        <p class="text-white/40 mb-1">Updated</p>
                        <p class="text-white">{{ task.updated_at|date:"F d, Y • H:i" }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
